<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=390, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>KÖNIGIN - Filet-o-Fish</title>
  <link rel="stylesheet" href="/style/index.css">
  <link rel="stylesheet" href="/style/footer.css">
  <style>
    :root {
      --safe-top: env(safe-area-inset-top, 0px);
      --safe-bottom: env(safe-area-inset-bottom, 0px);
    }

    html, body {
      margin: 0; 
      padding: 0;
      width: 100vw;
      height: 100vh;
      background: #191919;
      overflow: hidden;
    }

    .app-frame {
      width: 100vw;
      height: 100vh;
      max-width: 100vw;
      max-height: 100vh;
      position: relative;
      margin: 0;
      border-radius: 0;
      overflow: hidden;
      box-shadow: none;
      background: #191919;
      padding-top: env(safe-area-inset-top, 0px);
      padding-bottom: env(safe-area-inset-bottom, 0px);
      top: 0; 
      left: 0; 
      right: 0; 
      bottom: 0;
      box-sizing: border-box;
    }

    /* 横向滑动背景容器 */
    .horizontal-bg-container {
      position: absolute;
      left: 0; 
      top: 0;
      width: 100%;
      height: 100%;
      overflow: hidden;
      z-index: 1;
    }

    /* 背景图片容器 - 可以左右滑动 */
    .bg-slider {
      position: absolute;
      left: 0; 
      top: 0;
      width: 300%; /* 3倍宽度，对应图片的3个部分 */
      height: 100%;
      background-image: url('../../img/guest/filet-o-fish_bg.png');
      background-size: auto 100%; /* 保持图片比例，高度100% */
      background-position: left center;
      background-repeat: no-repeat;
      transition: transform 0.3s ease-out;
      cursor: grab;
    }

    .bg-slider:active {
      cursor: grabbing;
    }

    /* 滑动指示器 */
    .slide-indicators {
      position: absolute;
      bottom: 120px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 8px;
      z-index: 10;
    }

    .indicator {
      width: 24px;
      height: 4px;
      border-radius: 2px;
      background: rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .indicator.active {
      background: rgba(255, 255, 255, 0.8);
      transform: scaleY(1.5);
    }

    /* 滑动提示 */
    .slide-hint {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: rgba(255, 255, 255, 0.6);
      font-size: 14px;
      font-family: "SimSun", "宋体", serif;
      text-align: center;
      z-index: 5;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .slide-hint.show {
      opacity: 1;
    }

    /* 内容层 */
    .content-layer {
      position: absolute;
      left: 0; 
      top: 0;
      width: 100%;
      height: 100%;
      z-index: 2;
      pointer-events: none;
    }

    .content-layer > * {
      pointer-events: auto;
    }

    /* 标题 */
    .page-title {
      position: absolute;
      top: 5%;
      left: 50%;
      transform: translateX(-50%);
      width: 300px;
      height: 120px;
      z-index: 2;
      pointer-events: none;
    }

    /* 交互按钮 */
    .interaction-btn {
      position: absolute;
      z-index: 10;
      display: block;
      cursor: pointer;
    }

    .btn-bed {
      top: 75%; /* 床的位置，大约79.3%从顶部 */
      left: 40%;
      transform: translate(-50%, -50%);
    }

    .btn-whisky {
      top: 65%; /* whisky的位置，大约65%从顶部 */
      left: 50%; /* 稍微偏右，对应whisky的位置 */
      transform: translate(-50%, -50%);
    }

    .interaction-btn img {
      width: 8vw;
      height: 8vw;
      min-width: 60px;
      min-height: 60px;
      max-width: 100px;
      max-height: 100px;
      display: block;
      pointer-events: auto;
      transition: all 0.2s ease;
    }

    .interaction-btn:hover img {
      filter: brightness(1.2);
      transform: scale(1.05);
    }

    .interaction-btn:active img {
      filter: brightness(0.8);
      transform: scale(0.95);
    }

    /* 按钮显示/隐藏控制 */
    .interaction-btn {
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }

    .interaction-btn.show {
      opacity: 1;
      visibility: visible;
    }

    /* 底部遮罩 */
    .bottom-mask {
      position: absolute;
      left: 0; 
      bottom: 0;
      width: 100%;
      height: 92px;
      background: #191919;
      z-index: 3;
      pointer-events: none;
    }

    /* 边界提示效果 */
    .boundary-hint {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      width: 40px;
      height: 40px;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
      pointer-events: none;
      z-index: 15;
    }

    .boundary-hint.show {
      opacity: 1;
    }

    .boundary-hint.left {
      left: 20px;
    }

    .boundary-hint.right {
      right: 20px;
    }

    .boundary-hint::before {
      content: '';
      width: 12px;
      height: 12px;
      border: 2px solid rgba(255, 255, 255, 0.6);
      border-top: none;
      border-right: none;
    }

    .boundary-hint.left::before {
      transform: rotate(45deg);
    }

    .boundary-hint.right::before {
      transform: rotate(-135deg);
    }

    /* 响应式调整 */
    @media (max-width: 768px) {
      .slide-indicators {
        bottom: 100px;
      }
      
      .indicator {
        width: 20px;
        height: 3px;
      }
      
      .boundary-hint {
        width: 30px;
        height: 30px;
      }
      
      .boundary-hint::before {
        width: 8px;
        height: 8px;
      }
    }

        /* 客单滚轮选项区域 */
        .guest-list-wrapper{
      position: absolute;
      left: 53%;
      transform: translateX(-50%);
      width: 180px;
      top: 22%;
      height: 240px;
      z-index: 2;
      display: flex;
      align-items: stretch;
      gap: 12px;
      opacity: 0;
      visibility: hidden;
      transition: opacity 0.3s ease, visibility 0.3s ease;
    }
    
    .guest-list-wrapper.show {
      opacity: 1;
      visibility: visible;
    }
    
    .guest-list{
      position: relative;
      flex: 1 1 auto;
      height: 100%;
      overflow: hidden;
      -webkit-mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,1) 36px, rgba(0,0,0,1) calc(100% - 36px), rgba(0,0,0,0) 100%);
      mask-image: linear-gradient(to bottom, rgba(0,0,0,0) 0, rgba(0,0,0,1) 36px, rgba(0,0,0,1) calc(100% - 36px), rgba(0,0,0,0) 100%);
    }
    
    .guest-list-viewport{
      height: 288px;
      overflow-y: auto;
      padding-right: 8px;
      scrollbar-width: none;
    }
    
    .guest-list-viewport::-webkit-scrollbar{ display: none; }
    
    .guest-item{
      height: 48px;
      margin: 16px 0;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 15px;
      font-family: "SimSun", "宋体", serif; /* 改为宋体 */
      letter-spacing: .5px;
      user-select: none;
      pointer-events: auto; /* 改为可点击 */
      cursor: pointer; /* 添加鼠标指针 */
      background: linear-gradient(180deg, #5a5a5a 0%, #4a4a4a 45%, #414141 100%);
      border: 1px solid #696969;
      border-radius: 14px;
      box-shadow: inset 0 1px 0 rgba(255,255,255,.12), inset 0 -2px 4px rgba(0,0,0,.35), 0 2px 10px rgba(0,0,0,.25);
      transition: all 0.2s ease; /* 添加过渡效果 */
    }
    
    .guest-item:hover {
      background: linear-gradient(180deg, #6a6a6a 0%, #5a5a5a 45%, #515151 100%);
      transform: scale(1.02);
    }
    
    .guest-item:active {
      transform: scale(0.98);
    }
    
    /* 右侧自定义滚动条 */
    .guest-scrollbar{
      position: relative;
      width: 14px;
      height: 100%;
    }
    
    .guest-scrollbar .track{
      position: absolute; inset: 0;
      background: url('../svg/private/scroll options.svg') center / 100% 100% no-repeat;
      opacity: .9;
    }
    
    .guest-scrollbar .thumb{
      position: absolute; left: 0; right: 0;
      height: 40px;
      background: url('../svg/private/single opition.svg') center center/contain no-repeat;
    }


    .interaction-btn:active img {
  /* 可选：按下变暗或缩放 */
  filter: brightness(0.8);
  transform: scale(0.92);
}
@keyframes btn-blink {
  0%   { opacity: 1; filter: drop-shadow(0 0 0px #fff6) brightness(1); }
  40%  { opacity: 0.6; filter: drop-shadow(0 0 8px #e6f3ff) brightness(1.3);}
  60%  { opacity: 1; filter: drop-shadow(0 0 16px #b5e2ff) brightness(1.5);}
  100% { opacity: 1; filter: drop-shadow(0 0 0px #fff6) brightness(1); }
}
.interaction-btn.blink img {
  animation: btn-blink 1.2s infinite;
  /* 可选：动画节奏平滑 */
  animation-timing-function: ease-in-out;
}

  </style>
</head>
<body>
  <div class="app-frame">
    <!-- 横向滑动背景 -->
    <div class="horizontal-bg-container">
      <div class="bg-slider" id="bgSlider"></div>
      
      <!-- 滑动提示 -->
      <div class="slide-hint" id="slideHint">
        左右滑动查看图片不同部分
      </div>
      
      <!-- 滑动指示器 -->
      <div class="slide-indicators" id="slideIndicators">
        <div class="indicator active" data-index="0"></div>
        <div class="indicator" data-index="1"></div>
      </div>
    </div>

    <!-- 内容层 -->
    <div class="content-layer">
      <div class="page-title"></div>
      
      <!-- 床上的交互按钮 -->
      <a href="#" class="interaction-btn btn-bed blink" title="Bed Interaction" id="bedButton">
        <img src="../svg/2nd floor button.svg" alt="Bed Button"/>
      </a>
          <!-- 客单滚轮选项（默认隐藏） -->
    <div class="guest-list-wrapper" id="guestList">
      <div class="guest-list">
        <div class="guest-list-viewport" id="guestViewport">
          <div class="guest-item" data-article="vampire.html">吸血惊情四百年</div>
          <div class="guest-item" data-article="cage.html">次元裂缝</div>
        </div>
      </div>
      <div class="guest-scrollbar" id="guestScrollbar">
        <div class="track"></div>
        <div class="thumb" id="guestThumb"></div>
      </div>
    </div>

      <!-- Whisky上的交互按钮 -->
      <a href="#" class="interaction-btn btn-whisky blink" title="Whisky Interaction" id="whiskyButton">
        <img src="../svg/2nd floor button.svg" alt="Whisky Button"/>
      </a>
      
      <!-- 边界提示 -->
      <div class="boundary-hint left" id="leftHint"></div>
      <div class="boundary-hint right" id="rightHint"></div>
    </div>

    <div class="bottom-mask"></div>
  </div>

  <!-- Footer自动插入点 -->
  <div id="footer-placeholder"></div>

  <script src="../js/footer.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      console.log('Filet-o-Fish page loaded');
      
      const bgSlider = document.getElementById('bgSlider');
      const slideIndicators = document.getElementById('slideIndicators');
      const indicators = slideIndicators.querySelectorAll('.indicator');
      const slideHint = document.getElementById('slideHint');
      const leftHint = document.getElementById('leftHint');
      const rightHint = document.getElementById('rightHint');
      const bedButton = document.getElementById('bedButton');
      const whiskyButton = document.getElementById('whiskyButton');
      
      let currentPosition = 0; // 当前位置（百分比）
      let isDragging = false;
      let startX = 0;
      let currentX = 0;
      let startPosition = 0; // 开始拖动时的位置
      let maxSlideDistance = 100; // 最大滑动距离，设置默认值

      // 初始化
      function initSlider() {
        // 动态计算最大滑动距离
        calculateMaxSlideDistance();
        
        updateSlider();
        showHint();
      }

      // 计算最大滑动距离
      function calculateMaxSlideDistance() {
        const img = new Image();
        img.onload = function() {
          const containerWidth = window.innerWidth;
          const imgWidth = this.width;
          const imgHeight = this.height;
          
          // 计算图片在容器中的实际显示宽度
          const containerHeight = window.innerHeight;
          const scale = containerHeight / imgHeight;
          const displayWidth = imgWidth * scale;
          
          // 计算可以滑动的距离（缩小滑动空间）
          if (displayWidth > containerWidth) {
            // 将滑动距离限制在图片实际可显示范围内
            const actualSlideDistance = displayWidth - containerWidth;
            // 缩小滑动空间，让两个指示器对应图片的实际范围
            maxSlideDistance = (actualSlideDistance / containerWidth) * 100 * 0.29; // 缩小到29% 适配背景图宽度
          } else {
            // 即使图片不需要滑动，也设置一个最小滑动距离用于测试
            maxSlideDistance = 50; // 设置一个默认值
          }
          
          console.log('Container width:', containerWidth);
          console.log('Image display width:', displayWidth);
          console.log('Max slide distance:', maxSlideDistance);
          
          updateSlider();
        };
        
        // 添加错误处理
        img.onerror = function() {
          console.error('Failed to load image');
          maxSlideDistance = 100; // 设置默认滑动距离
          updateSlider();
        };
        
        img.src = '../../img/guest/filet-o-fish_bg.png';
      }

      // 更新滑块位置
      function updateSlider() {
        // 限制滑动范围在0到-maxSlideDistance之间
        currentPosition = Math.max(-maxSlideDistance, Math.min(0, currentPosition));
        bgSlider.style.transform = `translateX(${currentPosition}%)`;
        
        // 更新指示器位置（可选，用于显示当前位置）
        updateIndicators();
        
        // 更新边界提示
        updateBoundaryHints();
        
        // 更新按钮显示状态
        updateButtonVisibility();
      }

      // 更新边界提示
      function updateBoundaryHints() {
        // 显示左边界提示（当在右边界时）
        if (currentPosition <= -maxSlideDistance + 5) {
          rightHint.classList.add('show');
        } else {
          rightHint.classList.remove('show');
        }
        
        // 显示右边界提示（当在左边界时）
        if (currentPosition >= -5) {
          leftHint.classList.add('show');
        } else {
          leftHint.classList.remove('show');
        }
      }

      // 更新按钮显示状态
      function updateButtonVisibility() {
        if (!bedButton || !whiskyButton) return;
        
        // 计算当前位置的百分比
        const progress = Math.abs(currentPosition) / maxSlideDistance;
        
        // 当在起始位置（床的位置）时显示床按钮
        if (progress < 0.3) {
          bedButton.classList.add('show');
        } else {
          bedButton.classList.remove('show');
        }
        
        // 当在第二个指示器位置（桌子位置）时显示whisky按钮
        if (progress >= 0.8) {
          whiskyButton.classList.add('show');
        } else {
          whiskyButton.classList.remove('show');
        }
      }

      // 更新指示器
      function updateIndicators() {
        if (maxSlideDistance <= 0) {
          // 如果不需要滑动，只激活第一个指示器
          indicators.forEach((indicator, index) => {
            indicator.classList.toggle('active', index === 0);
          });
          return;
        }
        
        const progress = Math.abs(currentPosition) / maxSlideDistance;
        // 调整为两个滑块：0 = 起始位置，1 = 结束位置
        const activeIndex = progress >= 0.5 ? 1 : 0;
        
        indicators.forEach((indicator, index) => {
          // 只使用前两个指示器（0和1）
          if (index <= 1) {
            indicator.classList.toggle('active', index === activeIndex);
          } else {
            indicator.classList.remove('active'); // 第三个指示器始终不激活
          }
        });
      }

      // 显示提示
      function showHint() {
        slideHint.classList.add('show');
        setTimeout(() => {
          slideHint.classList.remove('show');
        }, 3000);
      }

      // 切换到指定位置
      function goToPosition(percentage) {
        currentPosition = -percentage * maxSlideDistance / 100;
        updateSlider();
      }

      // 鼠标事件
      bgSlider.addEventListener('mousedown', function(e) {
        isDragging = true;
        startX = e.clientX;
        currentX = startX;
        startPosition = currentPosition; // 记录开始拖动时的位置
        bgSlider.style.cursor = 'grabbing';
        bgSlider.style.transition = 'none';
      });

      document.addEventListener('mousemove', function(e) {
        if (!isDragging) return;
        
        currentX = e.clientX;
        const diff = currentX - startX;
        
        // 确保maxSlideDistance有值
        if (maxSlideDistance <= 0) {
          maxSlideDistance = 100; // 设置默认值
        }
        
        const moveDistance = (diff / window.innerWidth) * maxSlideDistance;
        
        // 计算目标位置（基于开始拖动时的位置）
        let targetPosition = startPosition - (diff / window.innerWidth) * maxSlideDistance;
        
        console.log('Dragging - diff:', diff, 'targetPosition:', targetPosition, 'maxSlideDistance:', maxSlideDistance);
        
        // 添加边界限制和阻力效果
        if (targetPosition > 0) {
          // 向右滑动超出左边界，添加阻力
          targetPosition = targetPosition * 0.3;
        } else if (targetPosition < -maxSlideDistance) {
          // 向左滑动超出右边界，添加阻力
          const overDistance = Math.abs(targetPosition + maxSlideDistance);
          targetPosition = -maxSlideDistance - (overDistance * 0.3);
        }
        
        currentPosition = targetPosition;
        bgSlider.style.transform = `translateX(${currentPosition}%)`;
      });

      document.addEventListener('mouseup', function() {
        if (!isDragging) return;
        
        isDragging = false;
        bgSlider.style.cursor = 'grab';
        bgSlider.style.transition = 'transform 0.3s ease-out';
        
        // 确保最终位置在有效范围内
        currentPosition = Math.max(-maxSlideDistance, Math.min(0, currentPosition));
        updateSlider();
      });

      // 触摸事件（移动端）
      bgSlider.addEventListener('touchstart', function(e) {
        isDragging = true;
        startX = e.touches[0].clientX;
        currentX = startX;
        startPosition = currentPosition; // 记录开始拖动时的位置
        bgSlider.style.transition = 'none';
      });

      document.addEventListener('touchmove', function(e) {
        if (!isDragging) return;
        
        currentX = e.touches[0].clientX;
        const diff = currentX - startX;
        
        // 确保maxSlideDistance有值
        if (maxSlideDistance <= 0) {
          maxSlideDistance = 100; // 设置默认值
        }
        
        const moveDistance = (diff / window.innerWidth) * maxSlideDistance;
        
        // 计算目标位置（基于开始拖动时的位置）
        let targetPosition = startPosition - (diff / window.innerWidth) * maxSlideDistance;
        
        console.log('Touch dragging - diff:', diff, 'targetPosition:', targetPosition, 'maxSlideDistance:', maxSlideDistance);
        
        // 添加边界限制和阻力效果
        if (targetPosition > 0) {
          // 向右滑动超出左边界，添加阻力
          targetPosition = targetPosition * 0.3;
        } else if (targetPosition < -maxSlideDistance) {
          // 向左滑动超出右边界，添加阻力
          const overDistance = Math.abs(targetPosition + maxSlideDistance);
          targetPosition = -maxSlideDistance - (overDistance * 0.3);
        }
        
        currentPosition = targetPosition;
        bgSlider.style.transform = `translateX(${currentPosition}%)`;
      });

      document.addEventListener('touchend', function() {
        if (!isDragging) return;
        
        isDragging = false;
        bgSlider.style.transition = 'transform 0.3s ease-out';
        
        // 确保最终位置在有效范围内
        currentPosition = Math.max(-maxSlideDistance, Math.min(0, currentPosition));
        updateSlider();
      });

      // 指示器点击事件
      indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', function() {
          if (maxSlideDistance <= 0) {
            // 如果不需要滑动，点击任何指示器都回到起始位置
            currentPosition = 0;
            updateSlider();
            return;
          }
          
          // 只使用前两个指示器
          if (index <= 1) {
            const percentage = index * 100; // 0% 或 100%
            goToPosition(percentage);
          }
        });
      });

      // 键盘事件
      document.addEventListener('keydown', function(e) {
        if (e.key === 'ArrowLeft') {
          currentPosition = Math.max(-maxSlideDistance, currentPosition - 20);
          updateSlider();
        } else if (e.key === 'ArrowRight') {
          currentPosition = Math.min(0, currentPosition + 20);
          updateSlider();
        }
      });

  // 床按钮点击事件
  const bedBtn = document.querySelector('.btn-bed');
  const guestList = document.getElementById('guestList');
  let isGuestListVisible = false;
  
  // 确保页面加载时滚轮选项是隐藏的
  if (guestList) {
    guestList.classList.remove('show');
    isGuestListVisible = false;
  }
  
  if (bedBtn) {
    bedBtn.addEventListener('click', function(e) {
      e.preventDefault();
      console.log('Bed button clicked');
      
      // 切换滚轮选项的显示/隐藏
      if (isGuestListVisible) {
        guestList.classList.remove('show');
        isGuestListVisible = false;
      } else {
        guestList.classList.add('show');
        isGuestListVisible = true;
      }
    });
  }
  
  // 点击空白区域隐藏滚轮选项
  document.addEventListener('click', function(e) {
    // 如果滚轮选项是显示的，且点击的不是床按钮或滚轮选项内部
    if (isGuestListVisible && guestList) {
      const isClickOnBedBtn = bedBtn && bedBtn.contains(e.target);
      const isClickOnGuestList = guestList.contains(e.target);
      
      if (!isClickOnBedBtn && !isClickOnGuestList) {
        guestList.classList.remove('show');
        isGuestListVisible = false;
      }
    }
  });
  
  // 自定义滚动条与滚轮同步
  const viewport = document.getElementById('guestViewport');
  const thumb = document.getElementById('guestThumb');
  const scrollbar = document.getElementById('guestScrollbar');
  
  if(viewport && thumb && scrollbar) {
    function updateThumb(){
      const viewH = viewport.clientHeight;
      const scrollH = viewport.scrollHeight;
      const trackH = scrollbar.clientHeight;
      const minThumb = 24;
      const thumbH = Math.max(minThumb, Math.round(viewH * viewH / Math.max(scrollH, 1)));
      const maxTop = Math.max(trackH - thumbH, 0);
      const top = (viewport.scrollTop / Math.max(scrollH - viewH, 1)) * maxTop;
      thumb.style.height = thumbH + 'px';
      thumb.style.top = top + 'px';
    }

    // 监听滚动和尺寸变化
    viewport.addEventListener('scroll', updateThumb, { passive: true });
    window.addEventListener('resize', updateThumb);
    // 初始化
    updateThumb();
  }
  
  // 滚轮选项点击跳转
  const guestItems = document.querySelectorAll('.guest-item');
  guestItems.forEach(item => {
    item.addEventListener('click', function() {
      const articleFile = this.getAttribute('data-article');
      if (articleFile) {
        console.log('Jumping to article:', articleFile);
        if (articleFile === 'vampire.html') {
          window.location.href = `../../article/vampire.html`;
        } else if (articleFile === 'cage.html') {
          window.location.href = `../../article/cage.html`;
        } else {
          window.location.href = `../../article/${articleFile}`;
        }
      }
    });
  });

      // Whisky按钮点击事件
      if (whiskyButton) {
        whiskyButton.addEventListener('click', function(e) {
          e.preventDefault();
          console.log('Whisky button clicked');
          // 跳转到2049.html文章页面
          window.location.href = '../../article/2049.html';
        });
      }

      // 初始化
      initSlider();

      // 检查footer是否加载
      setTimeout(() => {
        const footer = document.querySelector('.bottom-nav');
        if (footer) {
          console.log('Footer loaded successfully');
        } else {
          console.log('Footer not found');
        }
      }, 1000);
    });
  </script>
</body>
</html>
